function ExperimentQuickPicker_GUI(parent, bottom, left, GUIgetters, GUIsetters)
%-------------------------------------------------------------------------------
% File name   : boxcarFilter_GUI.m       
% Generated on: 07-Oct-2010 16:13:57          
% Description :
%-------------------------------------------------------------------------------


% Initialize handles structure
handles = struct();

% if there is no parent figure given, generate one
if nargin < 1 || ~isnumeric(parent)
	handles.figure1 = figure( ...
			'Tag', 'figure1', ...
			'Units', 'characters', ...
			'Position', [103.833333333333 13.8571428571429 64 12], ...
			'Name', 'Experiment QuickPick', ...
			'MenuBar', 'none', ...
			'NumberTitle', 'off', ...
			'Color', get(0,'DefaultUicontrolBackgroundColor'));
	
	left = 10.0;
	bottom = 10.0;
else
	handles.figure1 = parent;
end

%Load the experiments from the json cfg file
expParams = struct();
loadJSON()

% Create all UI controls
build_gui();




%% ---------------------------------------------------------------------------
	function build_gui()
% Creation of all uicontrols

		% --- PANELS -------------------------------------
		handles.uipanel1 = uipanel( ...
			'Parent', handles.figure1, ...
			'Tag', 'uipanel1', ...
			'Units', 'pixels', ...
			'Position', [left bottom 350 90], ...
			'FontName', 'Helvetica', ...
			'FontSize', 10, ...
			'Title', 'Experiment Quick Picker');

        	handles.text1 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text1', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [0.5 3.2 20 1.5], ...
			'FontName', 'Helvetica', ...
			'FontSize', 10, ...
			'String', 'Experiment');

            %Drop down menu
            handles.expDropDown = uicontrol( ...
            'Parent', handles.uipanel1, ...
            'Tag', 'Experiment', ...
            'Style', 'popupmenu', ...
            'Units', 'characters', ...
            'Position', [0.5 1 20 1.5], ...
            'BackgroundColor', [1 1 1], ...
            'FontName', 'Helvetica', ...
            'FontSize', 10, ...
            'String', fieldnames(expParams), ...
            'Callback', @updateFields);
    
        	handles.text2 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text2', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [25 3.2 20 1.5], ...
			'FontName', 'Helvetica', ...
			'FontSize', 10, ...
			'String', 'Channel');

            %Drop down menu
            handles.channelDropDown = uicontrol( ...
            'Parent', handles.uipanel1, ...
            'Tag', 'Channel', ...
            'Style', 'popupmenu', ...
            'Units', 'characters', ...
            'Position', [25 1 20 1.5], ...
            'BackgroundColor', [1 1 1], ...
            'FontName', 'Helvetica', ...
            'FontSize', 10, ...
            'String', {'TekAWG12','TekAWG34','BBNAPS12','BBNAPS34'}, ...
            'Callback', @updateFields);
        
            %Update from file button
            runHandle = uicontrol(...
            'Parent', handles.uipanel1, ...
        	'Style', 'pushbutton', ...
            'Units', 'characters', ...
            'String', 'Reload', ...
            'Position', [50 1, 15, 1.5], ...
            'FontName', 'Helvetica', ...
            'Callback', {@loadJSON});
        
    end

    function loadJSON(~,~)
        expParams = jsonlab.loadjson(getpref('qlab', 'ExpQuickPickFile'));
    end
    
    function updateFields(~,~)
        %Get the current values
        expNames = get(handles.expDropDown,'String');
        expName = expNames{get(handles.expDropDown,'Value')};
        channelNames = get(handles.channelDropDown,'String');
        channelName = channelNames{get(handles.channelDropDown,'Value')};
 
        %Update the sequence files for the Tek and APS
        %Get the current Tek5104 settings
        TekSettings_fcn = GUIgetters('TekAWG');
        TekSettings = TekSettings_fcn();
        
        %Get the current APS settings
        APSSettings_fcn = GUIgetters('BBNAPS');
        APSSettings = APSSettings_fcn();
        
        %Set the new names
        switch channelName
            case {'TekAWG12','TekAWG34'}
                %Update the sequence files 
                TekSettings.seqfile = fullfile(expParams.networkDrive, 'AWG', expParams.(expName).baseName, [expParams.(expName).baseName channelName '.awg']);
                tmpSettings_fcn = GUIsetters('TekAWG');
                tmpSettings_fcn(TekSettings)
                
                APSSettings.seqfile = fullfile(expParams.networkDrive, 'APS', 'Trigger', 'Trigger.mat');
                tmpSettings_fcn = GUIsetters('BBNAPS');
                tmpSettings_fcn(APSSettings)
                
            case {'BBNAPS12','BBNAPS34'}
                %Update the sequence files 
                TekSettings.seqfile = fullfile(expParams.networkDrive, 'AWG', 'Trigger', 'Trigger.awg');
                tmpSettings_fcn = GUIsetters('TekAWG');
                tmpSettings_fcn(TekSettings)
                
                APSSettings.seqfile = fullfile(expParams.networkDrive, 'APS', expParams.(expName).baseName, [expParams.(expName).baseName channelName '.mat']);
                tmpSettings_fcn = GUIsetters('BBNAPS');
                tmpSettings_fcn(APSSettings)
        end
        
        %Update the number of segments
        digitizerSettings_fcn = GUIgetters('digitizer');
        digitizerSettings = digitizerSettings_fcn();
        digitizerSettings.averager.nbrSegments = expParams.(expName).nbrSegments;
        tmpSettings_fcn = GUIsetters('digitizer');
        tmpSettings_fcn(digitizerSettings);
        
        %Update the x-axis settings
        xaxisSettings_fcn = GUIgetters('xaxis');
        xaxisSettings = xaxisSettings_fcn();
        xaxisSettings.start = expParams.(expName).xaxis.start;
        xaxisSettings.step = expParams.(expName).xaxis.step;
        tmpSettings_fcn = GUIsetters('xaxis');
        tmpSettings_fcn(xaxisSettings);
        
        %Update the experiment name
        set(GUIsetters('exptBox'),'String',expParams.(expName).expName);
        
    end    

end