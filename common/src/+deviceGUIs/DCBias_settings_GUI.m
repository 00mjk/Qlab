function setting_fcn = DCBias_settings_GUI(parent, bottom, left, settings)
% DCBIAS_settings_GUI
%-------------------------------------------------------------------------------
% File name   : DCBias_settings_GUI.m                
% Generated on: 28-Oct-2010 16:07:03          
% Description :
%-------------------------------------------------------------------------------


% Initialize handles structure
handles = struct();


% if there is no parent figure given, generate one
if nargin < 1 || ~isnumeric(parent)
	handles.figure1 = figure( ...
			'Tag', 'figure1', ...
			'Units', 'characters', ...
			'Position', [103.833333333333 13.8571428571429 90 22], ...
			'Name', 'DC Bias settings', ...
			'MenuBar', 'none', ...
			'NumberTitle', 'off', ...
			'Color', get(0,'DefaultUicontrolBackgroundColor'));
	
	left = 10.0;
	bottom = 10.0;
else
	handles.figure1 = parent;
end
name = 'BBN DC Bias Settings';

% Create all UI controls
build_gui();

if nargin < 4
	settings = struct();
end
set_defaults(settings);

% Assign function output
setting_fcn = @get_settings;

%% ---------------------------------------------------------------------------
	function build_gui()
% Creation of all uicontrols

		% --- PANELS -------------------------------------
		handles.uipanel1 = uipanel( ...
			'Parent', handles.figure1, ...
			'Tag', 'uipanel1', ...
			'UserData', zeros(1,0), ...
			'Units', 'pixels', ...
			'Position', [left bottom 373 205], ...
			'FontName', 'Helvetica', ...
			'FontSize', 10, ...
			'Title', name);

		% --- STATIC TEXTS -------------------------------------
		handles.text1 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text1', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [4.2 3.46153846153847 10.4 1.07692307692308], ...
			'String', 'Address');

		handles.text2 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text2', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [1 11.4615384615385 8 1.07692307692308], ...
			'String', 'Slot 1');

		handles.text3 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text3', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [11.8 12.8461538461538 5 1.07692307692308], ...
			'String', 'Ch0');

		handles.text4 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text4', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [22.4 12.8461538461538 5 1.07692307692308], ...
			'String', 'Ch1');

		handles.text5 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text5', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [32.4 12.8461538461538 5 1.07692307692308], ...
			'String', 'Ch2');

		handles.text6 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text6', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [43.8 12.8461538461538 5 1.07692307692308], ...
			'String', 'Ch3');

		handles.text7 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text7', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [54.2 12.8461538461538 5 1.07692307692308], ...
			'String', 'Ch4');

		handles.text8 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text8', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [64.6 12.8461538461538 5 1.07692307692308], ...
			'String', 'Ch5');

		handles.text9 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text9', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [1 7 8 1.07692307692308], ...
			'String', 'Slot 2');

		handles.text10 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text10', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [11.8 8.38461538461539 5 1.07692307692308], ...
			'String', 'Ch6');

		handles.text11 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text11', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [22.4 8.38461538461539 5 1.07692307692308], ...
			'String', 'Ch7');

		handles.text12 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text12', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [32.4 8.38461538461539 5 1.07692307692308], ...
			'String', 'Ch8');

		handles.text13 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text13', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [43.8 8.38461538461539 5 1.07692307692308], ...
			'String', 'Ch9');

		handles.text14 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text14', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [54.2 8.38461538461539 5 1.07692307692308], ...
			'String', 'Ch10');

		handles.text15 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'text15', ...
			'Style', 'text', ...
			'Units', 'characters', ...
			'Position', [64.6 8.38461538461539 5 1.07692307692308], ...
			'String', 'Ch11');

		% --- RADIO BUTTONS -------------------------------------
		handles.ch0on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch0on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [10.6 9.46153846153847 7 1.76923076923077], ...
			'String', 'on');

		handles.ch1on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch1on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [21.4 9.46153846153847 7 1.76923076923077], ...
			'String', 'on');

		handles.ch2on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch2on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [31.8 9.46153846153847 7 1.76923076923077], ...
			'String', 'on');

		handles.ch3on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch3on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [42.8 9.46153846153847 7 1.76923076923077], ...
			'String', 'on');

		handles.ch4on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch4on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [53.2 9.46153846153847 7 1.76923076923077], ...
			'String', 'on');

		handles.ch5on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch5on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [63.4 9.46153846153847 7 1.76923076923077], ...
			'String', 'on');

		handles.ch6on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch6on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [10.6 5 7 1.76923076923077], ...
			'String', 'on');

		handles.ch7on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch7on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [21.4 5 7 1.76923076923077], ...
			'String', 'on');

		handles.ch8on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch8on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [31.8 5 7 1.76923076923077], ...
			'String', 'on');

		handles.ch9on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch9on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [42.2 5 7 1.76923076923077], ...
			'String', 'on');

		handles.ch10on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch10on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [52.6 5 7 1.76923076923077], ...
			'String', 'on');

		handles.ch11on = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch11on', ...
			'Style', 'radiobutton', ...
			'Units', 'characters', ...
			'Position', [63.4 5 7 1.76923076923077], ...
			'String', 'on');

		% --- CHECKBOXES -------------------------------------
		handles.enable = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'enable', ...
			'Style', 'checkbox', ...
			'Units', 'characters', ...
			'Position', [16 1.53846153846154 15 1.76923076923077], ...
			'String', 'enable');

		% --- EDIT TEXTS -------------------------------------
		handles.Address = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'Address', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [4.6 1.61538461538462 9.8 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', 'COM4');

		handles.ch0 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch0', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [9.8 11.2307692307692 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch1 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch1', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [20.4 11.2307692307692 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch2 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch2', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [31 11.2307692307692 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');
		
		handles.ch3 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch3', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [41.6 11.2307692307692 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch4 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch4', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [52.2 11.2307692307692 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch5 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch5', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [62.6 11.2307692307692 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch6 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch6', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [9.8 6.76923076923078 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch7 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch7', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [20.4 6.76923076923078 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch8 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch8', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [31 6.76923076923078 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch9 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch9', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [41.6 6.76923076923078 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');
		
		handles.ch10 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch10', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [52.2 6.76923076923078 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');

		handles.ch11 = uicontrol( ...
			'Parent', handles.uipanel1, ...
			'Tag', 'ch11', ...
			'Style', 'edit', ...
			'Units', 'characters', ...
			'Position', [62.6 6.76923076923078 9 1.53846153846154], ...
			'BackgroundColor', [1 1 1], ...
			'String', '');


	end

	function selected = get_selected(hObject)
		menu = get(hObject,'String');
		selected = menu{get(hObject,'Value')};
	end

	function set_selected(hObject, val)
		menu = get(hObject, 'String');
		index = find(strcmp(val, menu));
		if ~isempty(index)
			set(hObject, 'Value', index);
		end
	end

	function value = get_numeric(hObject)
		value = str2num(get(hObject, 'String'));
	end

	function settings = get_settings()
		settings = struct();
		
		settings.enable = get(handles.enable, 'Value');
		settings.deviceName = 'DCBias';
		settings.Address = get(handles.Address, 'String');
		for i = 0:11
			chName = ['ch' num2str(i)];
			value_field = handles.(chName);
			enable_field = handles.([chName 'on']);
			settings.(chName) = get_numeric(value_field);
			settings.([chName 'on']) = get(enable_field, 'Value');
		end
	end

	function set_defaults(settings)
		% define default values for fields. If given a settings structure, grab
		% defaults from it
		defaults.Address = 'COM4';
		defaults.enable = 0;
		for i = 0:11
			chName = ['ch' num2str(i)];
			defaults.(chName) = 0;
			defaults.([chName 'on']) = 0;
		end

		if ~isempty(fieldnames(settings))
			fields = fieldnames(settings);
			for i = 1:length(fields)
				name = fields{i};
				defaults.(name) = settings.(name);
			end
		end
		
		set(handles.enable, 'Value', defaults.enable);
		set(handles.Address, 'String', defaults.Address);
		for i = 0:11
			chName = ['ch' num2str(i)];
			set(handles.(chName), 'String', num2str(defaults.(chName)));
			set(handles.([chName 'on']), 'Value', defaults.([chName 'on']));
		end
	end

end
